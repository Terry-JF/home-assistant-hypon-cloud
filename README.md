# Hypon Cloud Addon for Home Assistant - an enhanced version of the code @ https://github.com/amckee23/home-assistant-hypon-cloud

This repository contains a Hypon cloud integration for Home Assistant.  This is provided without warranty and is for personal use only.

## Installation (updated to reflect version 17.1 of HA)

### Method 1: App Repository

1.	In Home Assistant go to: **Settings** → **Apps** → **Install app**  (button at bottom right), this takes you to the App store screen, then click  **⋮** (top right) and select **Repositories**
2.	Paste this URL into the field:
```https://github.com/Terry-JF/home-assistant-hypon-cloud```
and click "+add" then once the entry appears in the list (assuming you already have other entries, else it will be alone), click "close", you're now back in the App store screen.
3. Within the App store, find **Hypon Cloud Addon for Home Assistant** (scroll down, as its normally close to the bottom), and click on Hypon Cloud to open the app setup form.
4. Within the form click **Install**, when finished select the **Configuration** tab and enter your details (see below), then go back to the **Info** tab and press **Start**. You can monitor issues in the **Log** tab. Double check your System ID if connection fails, this is not your User ID.

### Method 2: Manual Installation

1. Clone this repository to your local machine:
git clone https://github.com/Terry-JF/home-assistant-hypon-cloud hypon_cloud
cd into the hypon_cloud folder

2. from the top level of the repository run `scp -r -O hypon-cloud [user]@[ip]:/addons`
    Note:: Please ensure you have the ssh plugin installed in home assistant with sftp enabled.  Instructions can be found [here](https://community.home-assistant.io/t/home-assistant-community-add-on-ssh-web-terminal/33820)

3. Navigate in your Home Assistant frontend to **Settings** -> **Apps** -> **Install app** -> **Select 3 dot menu** -> **Check for updates** 

4. Install the Hypon Cloud Addon. Ensuring the following configuration is set:
    - `username` - Your Hypon Cloud username (as used in mobile/web access)
    - `password` - Your Hypon Cloud password
    - `system_id` - The system ID of the Hypon device you wish to control (this can be found in your Hypon Cloud dashboard)
    - `refresh_time` - The time in seconds between each refresh of the Hypon Cloud Data (default 300)

## Sensors 
The following sensors are available once the addon is installed:
(Remember, Power is in Watts and is instantaneous, Energy is in kWh and is a measure of total power produced/consumed within any notional one hour period)
(e.g. a 3kW heater turned on for exactly 30 minutes will consume 1.5kWh of energy)

### Energy Sensors (14)
- `sensor.hypon_inverter_ac_out_today` - The amount of energy out of the inverter AC connection today 
- `sensor.hypon_total_energy_used_today` - The total amount of energy used by the home/load today (typically the sum of the next 3 sensor values)
- `sensor.hypon_battery_used_today` - The amount of energy out of the battery today (if included in your system) battery output - battery input, so can be negative
- `sensor.hypon_grid_used_today` - The amount of energy taken from the grid today via your meter/CT
- `sensor.hypon_pv_used_today` - The amount of solar energy that has been used by the home/load today (excludes energy sent to battery)
- `sensor.hypon_total_pv_generated_today` - The total amount of solar energy generated by your panels today (typically the sum of the next 3 sensor values, but does not account for small inverter losses)
- `sensor.hypon_pv_to_battery_today` - The total amount of energy input to the battery today (battery in - battery out, or 0 if negative)
- `sensor.hypon_pv_to_grid_today` - The amount of energy exported to the grid today
- `sensor.hypon_pv_to_load_today` - The total energy sent to your home/load today
- `sensor.hypon_energy_used_less_inverter_output` - The 'total_energy_used_today' less 'inverter_ac_out_today'
- `sensor.hypon_pv_generation_total` - The amount of solar energy generated since the inverter was commissioned/reset
- `sensor.hypon_pv_generation_month` - The amount of solar energy generated this month (always reads the same as 'today' on my system, may be a bug in hypon.cloud)
- `sensor.hypon_pv_generation_today` - The amount of solar energy generated today (seems to work correctly)
- `sensor.hypon_pv_generation_year` - The amount of solar energy generated this year (always reads 0 on my system, may be a bug in hypon.cloud)

### Power & Other Sensors (8)
- `sensor.hypon_self_consumption_percent` - The percentage of total solar generation that was used by the home/load today
- `sensor.hypon_grid_power_now` - The amount of power being imported from the grid in near real time (probably a minute or two ago)
- `sensor.hypon_load_power_now` - The amount of power being used by the home/load in near real time
- `sensor.hypon_battery_charge_power_now` - The amount of power being fed in/out of the battery in near real time (+ve number = out, -ve number = in/charging)
- `sensor.hypon_pv_power_now` - The amount of power being generated by the pv panels in near real time
- `sensor.hypon_battery_soc` - The state-of-charge of the battery in percent
- `sensor.hypon_micro_power` - Not exactly sure what this measures, always 0 on my system - may be to do with micro generation systems
- `sensor.hypon_inverter_warning` - Not exactly sure how this works, always 0 so far on my system - may be useful to monitor within HA and alert if it changes

